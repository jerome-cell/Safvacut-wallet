<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Safvacut - Advanced Crypto Dashboard</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Orbitron:wght@400;500;600;700;800&display=swap"
    rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Favicon -->
  <link rel="shortcut icon"
    href="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/logo-ESKwzmjR7tbreApAoFqaXonObbk7qV.png"
    type="image/png">
  <link rel="apple-touch-icon"
    href="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/logo-ESKwzmjR7tbreApAoFqaXonObbk7qV.png">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- AOS Animation -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          screens: {
            'xs': '475px',
          },
          colors: {
            primary: {
              50: '#fff7ed',
              100: '#ffedd5',
              200: '#fed7aa',
              300: '#fdba74',
              400: '#fb923c',
              500: '#f97316',
              600: '#ea580c',
              700: '#c2410c',
              800: '#9a3412',
              900: '#7c2d12',
            },
            bitcoin: '#f7931e',
            ethereum: '#627eea',
            success: '#10b981',
            danger: '#ef4444',
            warning: '#f59e0b',
            crypto: {
              orange: '#f7931a',
              dark: '#0f0f23',
              darker: '#1a1a2e',
            }
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'slide-in': 'slideIn 0.3s ease-out',
            'slide-up': 'slideUp 0.3s ease-out',
            'fade-in': 'fadeIn 0.5s ease-out',
            'bounce-in': 'bounceIn 0.6s ease-out',
            'shimmer': 'shimmer 2s linear infinite',
            'gradient': 'gradient 3s ease infinite',
            'spin-slow': 'spin 3s linear infinite',
            'wiggle': 'wiggle 1s ease-in-out infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0px) rotate(0deg)' },
              '50%': { transform: 'translateY(-20px) rotate(180deg)' }
            },
            glow: {
              'from': { boxShadow: '0 0 30px rgba(247, 147, 30, 0.3)' },
              'to': { boxShadow: '0 0 40px rgba(247, 147, 30, 0.6)' }
            },
            slideIn: {
              'from': { transform: 'translateX(-100%)', opacity: '0' },
              'to': { transform: 'translateX(0)', opacity: '1' }
            },
            slideUp: {
              'from': { transform: 'translateY(100%)', opacity: '0' },
              'to': { transform: 'translateY(0)', opacity: '1' }
            },
            fadeIn: {
              'from': { opacity: '0' },
              'to': { opacity: '1' }
            },
            bounceIn: {
              '0%': { transform: 'scale(0.3)', opacity: '0' },
              '50%': { transform: 'scale(1.05)' },
              '70%': { transform: 'scale(0.9)' },
              '100%': { transform: 'scale(1)', opacity: '1' }
            },
            shimmer: {
              '0%': { backgroundPosition: '-200% 0' },
              '100%': { backgroundPosition: '200% 0' }
            },
            gradient: {
              '0%, 100%': { backgroundPosition: '0% 50%' },
              '50%': { backgroundPosition: '100% 50%' }
            },
            wiggle: {
              '0%, 100%': { transform: 'rotate(-3deg)' },
              '50%': { transform: 'rotate(3deg)' }
            }
          },
          fontFamily: {
            'orbitron': ['Orbitron', 'monospace'],
            'inter': ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
      overflow-x: hidden;
    }

    .orbitron {
      font-family: 'Orbitron', monospace;
    }

    .balance-display {
      font-family: 'Inter', sans-serif;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .dark-theme {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      color: #ffffff;
    }

    .dark-theme::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 20% 80%, rgba(247, 147, 30, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(102, 126, 234, 0.05) 0%, transparent 50%);
      z-index: 1;
      pointer-events: none;
    }

    .light-theme {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
      color: #1e293b;
    }

    .glass-effect {
      backdrop-filter: blur(20px);
      transition: all 0.3s ease;
      position: relative;
      z-index: 10;
    }

    .dark .glass-effect {
      background: rgba(15, 15, 35, 0.8);
      border: 1px solid rgba(247, 147, 30, 0.2);
    }

    .light .glass-effect {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .crypto-glow {
      transition: all 0.3s ease;
    }

    .dark .crypto-glow {
      box-shadow: 0 0 30px rgba(247, 147, 30, 0.3);
    }

    .light .crypto-glow {
      box-shadow: 0 0 30px rgba(247, 147, 30, 0.15);
    }

    .btn-primary {
      background: linear-gradient(135deg, #f7931e 0%, #ff6b35 100%);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .btn-primary:hover::before {
      left: 100%;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #e8851c 0%, #e55a2b 100%);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(247, 147, 30, 0.4);
    }

    .gradient-text {
      background: linear-gradient(135deg, #f7931a 0%, #ff6b35 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .balance-card {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .dark .balance-card {
      background: linear-gradient(135deg, rgba(247, 147, 30, 0.1) 0%, rgba(255, 107, 53, 0.1) 100%);
    }

    .light .balance-card {
      background: linear-gradient(135deg, rgba(247, 147, 30, 0.05) 0%, rgba(255, 107, 53, 0.05) 100%);
    }

    .balance-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(247, 147, 30, 0.1), transparent);
      transition: left 0.5s;
    }

    .balance-card:hover::before {
      left: 100%;
    }

    .crypto-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .crypto-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(247, 147, 30, 0.1), transparent);
      transition: left 0.5s;
    }

    .crypto-card:hover::before {
      left: 100%;
    }

    .crypto-card:hover {
      transform: translateY(-8px) scale(1.02);
      border-color: #f7931e;
    }

    .dark .crypto-card:hover {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 20px rgba(247, 147, 30, 0.2);
    }

    .light .crypto-card:hover {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 0 20px rgba(247, 147, 30, 0.15);
    }

    .sidebar {
      transition: transform 0.3s ease;
    }

    .sidebar-collapsed {
      transform: translateX(-100%);
    }

    @media (min-width: 1024px) {
      .sidebar-collapsed {
        transform: translateX(-240px);
      }
    }

    .mobile-menu-overlay {
      transition: all 0.3s ease;
    }

    .mobile-menu-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .mobile-menu-overlay:not(.active) {
      opacity: 0;
      visibility: hidden;
    }

    .notification-dot {
      position: absolute;
      top: -2px;
      right: -2px;
      width: 8px;
      height: 8px;
      background: #ef4444;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .loading-skeleton {
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }

    .chart-container {
      position: relative;
      height: 300px;
    }

    @media (max-width: 768px) {
      .chart-container {
        height: 200px;
      }
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      animation: fadeIn 0.3s ease-out;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-content {
      border-radius: 20px;
      padding: 2rem;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: bounceIn 0.6s ease-out;
    }

    .dark .modal-content {
      background: rgba(15, 15, 35, 0.95);
      border: 1px solid rgba(247, 147, 30, 0.2);
      color: #ffffff;
    }

    .light .modal-content {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.1);
      color: #1e293b;
    }

    .qr-container {
      display: flex;
      justify-content: center;
      margin: 1.5rem 0;
    }

    .status-completed {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }

    .status-pending {
      background: rgba(245, 158, 11, 0.2);
      color: #f59e0b;
    }

    .status-failed {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .pulse-glow {
      animation: glow 2s ease-in-out infinite alternate;
    }

    .crypto-icon-bitcoin {
      background: linear-gradient(135deg, #f7931e 0%, #ff6b35 100%);
    }

    .crypto-icon-ethereum {
      background: linear-gradient(135deg, #627eea 0%, #3c3c3d 100%);
    }

    .crypto-icon-bnb {
      background: linear-gradient(135deg, #f0b90b 0%, #f8d12f 100%);
    }

    .crypto-icon-usdt {
      background: linear-gradient(135deg, #26a17b 0%, #50af95 100%);
    }

    .crypto-icon-trc20 {
      background: linear-gradient(135deg, #ff0013 0%, #ff4757 100%);
    }

    .crypto-icon-solana {
      background: linear-gradient(135deg, #9945ff 0%, #14f195 100%);
    }

    .crypto-icon-doge {
      background: linear-gradient(135deg, #c2a633 0%, #d4af37 100%);
    }

    .crypto-icon-cardano {
      background: linear-gradient(135deg, #0033ad 0%, #1e88e5 100%);
    }

    .crypto-icon-polygon {
      background: linear-gradient(135deg, #8247e5 0%, #a855f7 100%);
    }

    /* Fixed Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 30;
      display: none;
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(247, 147, 30, 0.2);
      padding: 8px 0;
    }

    .dark .bottom-nav {
      background: rgba(15, 15, 35, 0.95);
    }

    .light .bottom-nav {
      background: rgba(255, 255, 255, 0.95);
    }

    @media (max-width: 1024px) {
      .bottom-nav {
        display: flex;
      }

      .main-content {
        padding-bottom: 80px;
      }
    }

    /* Fixed Navigation Items */
    .nav-item {
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
      border-radius: 12px;
      min-width: 60px;
      text-align: center;
    }

    .nav-item:hover {
      background: rgba(247, 147, 30, 0.1);
    }

    .nav-item.active {
      background: rgba(247, 147, 30, 0.2);
      color: #f7931e;
    }

    .nav-item i {
      margin-bottom: 4px;
      font-size: 18px;
    }

    .nav-item span {
      font-size: 10px;
      font-weight: 500;
      line-height: 1;
    }

    /* Bottom nav container fix */
    .bottom-nav .flex {
      width: 100%;
      justify-content: space-around;
      align-items: center;
    }

    .transaction-item {
      transition: all 0.3s ease;
    }

    .transaction-item:hover {
      transform: translateX(5px);
    }

    .dark .transaction-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .light .transaction-item:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    .price-up {
      color: #10b981;
    }

    .price-down {
      color: #ef4444;
    }

    .price-neutral {
      color: #6b7280;
    }

    .loading-spinner {
      border: 2px solid rgba(247, 147, 30, 0.3);
      border-top: 2px solid #f7931e;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(247, 147, 30, 0.3);
      transform: scale(0);
      animation: ripple 0.6s linear;
      pointer-events: none;
    }

    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* Profile Image Upload */
    .profile-image-container {
      position: relative;
      display: inline-block;
    }

    .profile-image-upload {
      position: absolute;
      bottom: 0;
      right: 0;
      background: #f7931e;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .profile-image-upload:hover {
      background: #e8851c;
      transform: scale(1.1);
    }

    .user-id-container {
      background: rgba(247, 147, 30, 0.1);
      border: 1px solid rgba(247, 147, 30, 0.3);
      border-radius: 12px;
      padding: 12px;
      margin-top: 8px;
      transition: all 0.3s ease;
    }

    .user-id-container:hover {
      background: rgba(247, 147, 30, 0.15);
      border-color: rgba(247, 147, 30, 0.5);
    }

    .copy-button {
      transition: all 0.3s ease;
    }

    .copy-button:hover {
      background: rgba(247, 147, 30, 0.2);
      transform: scale(1.05);
    }

    /* Enhanced animations */
    .bounce-in {
      animation: bounceIn 0.6s ease-out;
    }

    .slide-in-right {
      animation: slideInRight 0.5s ease-out;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Responsive adjustments for phone mode */
    @media (max-width: 1023px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .main-content {
        margin-left: 0;
      }
    }

    @media (max-width: 640px) {
      .balance-card h2 {
        font-size: 1.75rem !important;
      }

      .welcome-header h1 {
        font-size: 1.25rem !important;
      }

      .action-buttons {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.75rem !important;
      }

      .crypto-item {
        padding: 0.75rem !important;
      }

      .crypto-icon {
        width: 2rem !important;
        height: 2rem !important;
      }

      .crypto-text {
        font-size: 0.875rem !important;
      }

      .crypto-price {
        font-size: 0.875rem !important;
      }
    }

    /* Touch-friendly buttons for mobile */
    @media (hover: none) and (pointer: coarse) {
      .crypto-card:hover {
        transform: none;
      }

      .btn-primary:hover {
        transform: none;
      }

      button,
      .nav-item {
        min-height: 44px;
        min-width: 44px;
      }
    }

    /* Focus states for accessibility */
    button:focus,
    .nav-item:focus,
    input:focus,
    select:focus,
    textarea:focus {
      outline: 2px solid #f7931e;
      outline-offset: 2px;
    }

    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }

    /* Enhanced Logo */
    .logo {
      font-family: 'Orbitron', monospace;
      font-size: 1.5rem;
      font-weight: 700;
      color: #f7931e;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    .logo img {
      height: 40px;
      width: 40px;
      object-fit: contain;
      border-radius: 8px;
      transition: all 0.3s ease;
      filter: drop-shadow(0 0 10px rgba(247, 147, 30, 0.3));
    }

    .logo img:hover {
      filter: drop-shadow(0 0 15px rgba(247, 147, 30, 0.5));
      transform: rotate(5deg);
    }

    /* QR Code Styling */
    .qr-code-display {
      background: white;
      padding: 16px;
      border-radius: 12px;
      display: inline-block;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    /* Modern Card Enhancements */
    .modern-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      transition: all 0.3s ease;
    }

    .modern-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(247, 147, 30, 0.1);
    }

    /* Floating Action Button */
    .fab {
      position: fixed;
      bottom: 100px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f7931e 0%, #ff6b35 100%);
      color: white;
      border: none;
      box-shadow: 0 8px 20px rgba(247, 147, 30, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 40;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .fab:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 30px rgba(247, 147, 30, 0.4);
    }

    @media (min-width: 1024px) {
      .fab {
        display: none;
      }
    }

    /* Form validation styles */
    .form-error {
      border-color: #ef4444 !important;
      box-shadow: 0 0 0 1px #ef4444 !important;
    }

    .form-success {
      border-color: #10b981 !important;
      box-shadow: 0 0 0 1px #10b981 !important;
    }

    /* Loading states */
    .btn-loading {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .btn-loading::after {
      content: '';
      width: 16px;
      height: 16px;
      margin-left: 8px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
    }

    /* ETH Warning Modal Styles */
    .eth-warning-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .eth-warning-content {
      background: rgba(15, 15, 35, 0.95);
      border: 1px solid rgba(247, 147, 30, 0.3);
      border-radius: 20px;
      padding: 2rem;
      max-width: 400px;
      width: 100%;
      text-align: center;
      animation: bounceIn 0.6s ease-out;
    }

    .eth-warning-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      font-size: 2rem;
      color: white;
      animation: pulse 2s infinite;
    }

    .eth-warning-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #f59e0b;
      margin-bottom: 1rem;
    }

    .eth-warning-message {
      color: #d1d5db;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .eth-warning-button {
      background: linear-gradient(135deg, #f7931e 0%, #ff6b35 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .eth-warning-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(247, 147, 30, 0.4);
    }
  </style>
</head>
<!-- Start of LiveChat (www.livechat.com) code -->
<script>
  window.__lc = window.__lc || {};
  window.__lc.license = 19255024;
  window.__lc.integration_name = "manual_channels";
  window.__lc.product_name = "livechat";
  ; (function (n, t, c) { function i(n) { return e._h ? e._h.apply(null, n) : e._q.push(n) } var e = { _q: [], _h: null, _v: "2.0", on: function () { i(["on", c.call(arguments)]) }, once: function () { i(["once", c.call(arguments)]) }, off: function () { i(["off", c.call(arguments)]) }, get: function () { if (!e._h) throw new Error("[LiveChatWidget] You can't use getters before load."); return i(["get", c.call(arguments)]) }, call: function () { i(["call", c.call(arguments)]) }, init: function () { var n = t.createElement("script"); n.async = !0, n.type = "text/javascript", n.src = "https://cdn.livechatinc.com/tracking.js", t.head.appendChild(n) } }; !n.__lc.asyncInit && e.init(), n.LiveChatWidget = n.LiveChatWidget || e }(window, document, [].slice))
</script>
<noscript><a href="https://www.livechat.com/chat-with/19255024/" rel="nofollow">Chat with us</a>, powered by <a
    href="https://www.livechat.com/?welcome" rel="noopener nofollow" target="_blank">LiveChat</a></noscript>
<!-- End of LiveChat code -->

<body class="dark dark-theme">
  <!-- Mobile Menu Overlay -->
  <div id="mobile-overlay" class="mobile-menu-overlay fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"></div>
  <!-- Sidebar -->
  <aside id="sidebar"
    class="sidebar fixed top-0 left-0 h-full w-64 glass-effect z-50 lg:translate-x-0 sidebar-collapsed">
    <div class="p-6">
      <!-- Logo -->
      <div class="flex items-center space-x-3 mb-8">
        <a href="index.html" class="logo">
          <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/logo-ESKwzmjR7tbreApAoFqaXonObbk7qV.png"
            alt="Safvacut Logo" id="logoImg" />
          <span>SAFVACUT</span>
        </a>
      </div>
      <!-- Navigation -->
      <nav class="space-y-2">
        <a href="#dashboard" class="nav-item active flex items-center space-x-3 p-3 rounded-lg transition-all"
          data-section="dashboard">
          <i class="fas fa-home w-5 h-5"></i>
          <span>Dashboard</span>
        </a>
        <a href="#portfolio" class="nav-item flex items-center space-x-3 p-3 rounded-lg transition-all"
          data-section="portfolio">
          <i class="fas fa-chart-pie w-5 h-5"></i>
          <span>Portfolio</span>
        </a>
        <a href="#trading" class="nav-item flex items-center space-x-3 p-3 rounded-lg transition-all"
          data-section="trading">
          <i class="fas fa-chart-line w-5 h-5"></i>
          <span>Trading</span>
        </a>
        <a href="#transactions" class="nav-item flex items-center space-x-3 p-3 rounded-lg transition-all"
          data-section="transactions">
          <i class="fas fa-exchange-alt w-5 h-5"></i>
          <span>Transactions</span>
          <div class="notification-dot"></div>
        </a>
        <a href="#staking" class="nav-item flex items-center space-x-3 p-3 rounded-lg transition-all"
          data-section="staking">
          <i class="fas fa-coins w-5 h-5"></i>
          <span>Staking</span>
        </a>
        <a href="#settings" class="nav-item flex items-center space-x-3 p-3 rounded-lg transition-all"
          data-section="settings">
          <i class="fas fa-cog w-5 h-5"></i>
          <span>Settings</span>
        </a>
      </nav>
      <!-- User Profile -->
      <div class="absolute bottom-6 left-6 right-6">
        <div class="glass-effect rounded-xl p-4">
          <div class="flex items-center space-x-3">
            <div class="profile-image-container">
              <img id="user-avatar" src="/placeholder.svg?height=40&width=40" alt="User Avatar"
                class="w-10 h-10 rounded-full object-cover">
              <div class="profile-image-upload" onclick="triggerImageUpload()">
                <i class="fas fa-camera text-white text-xs"></i>
              </div>
              <input type="file" id="profile-image-input" accept="image/*" style="display: none;">
            </div>
            <div class="flex-1 min-w-0">
              <p id="user-name" class="text-sm font-medium truncate">Loading...</p>
              <p id="user-email" class="text-xs text-gray-400 truncate">Loading...</p>
            </div>
            <button id="logout-btn" class="p-2 rounded-lg hover:bg-red-500 hover:bg-opacity-20 transition-all"
              aria-label="Logout">
              <i class="fas fa-sign-out-alt text-red-400 text-sm"></i>
            </button>
          </div>
          <!-- User ID Display -->
          <div class="user-id-container mt-3">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <p class="text-xs text-gray-400 mb-1">Your User ID</p>
                <p id="user-unique-id" class="text-sm font-mono text-orange-500">Loading...</p>
              </div>
              <button id="copy-user-id"
                class="copy-button p-2 rounded-lg hover:bg-orange-500 hover:bg-opacity-20 transition-all"
                aria-label="Copy User ID">
                <i class="fas fa-copy text-orange-500 text-sm"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>
  <!-- Main Content -->
  <main id="main-content" class="main-content lg:ml-64 min-h-screen">
    <!-- Header -->
    <header class="glass-effect border-b border-orange-500 border-opacity-20 sticky top-0 z-30">
      <div class="px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <!-- Welcome Message (Clickable on Mobile) -->
          <div class="welcome-header flex-1 lg:flex-none lg:cursor-default cursor-pointer" id="mobile-header-toggle"
            aria-label="Toggle sidebar">
            <h1 class="text-xl font-semibold">Welcome back, <span id="header-user-name"
                class="gradient-text">User</span>!</h1>
            <p class="text-sm text-gray-400 hidden sm:block">Manage your crypto portfolio with confidence</p>
          </div>
          <!-- Header Actions -->
          <div class="flex items-center space-x-4">
            <!-- Theme Toggle -->
            <button id="theme-toggle" class="p-2 rounded-lg hover:bg-orange-500 hover:bg-opacity-20 transition-all"
              aria-label="Toggle theme">
              <i id="theme-icon-dark" class="fas fa-moon w-5 h-5 hidden"></i>
              <i id="theme-icon-light" class="fas fa-sun w-5 h-5"></i>
            </button>
            <!-- Notifications -->
            <button class="p-2 rounded-lg hover:bg-orange-500 hover:bg-opacity-20 transition-all relative"
              aria-label="View notifications">
              <i class="fas fa-bell w-5 h-5"></i>
              <div class="notification-dot"></div>
            </button>
            <!-- Quick Actions -->
            <div class="hidden sm:flex items-center space-x-2">
              <button onclick="showReceiveModal()"
                class="btn-primary px-4 py-2 rounded-lg text-white font-medium text-sm">
                <i class="fas fa-qrcode w-4 h-4 mr-2"></i>
                Receive
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- Dashboard Content -->
    <div id="dashboard-section" class="section-content p-4 sm:p-6 lg:p-8">
      <!-- Balance Card -->
      <div class="balance-card glass-effect rounded-3xl p-6 sm:p-8 mb-8 crypto-glow" data-aos="fade-up">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
          <div>
            <h2 class="text-3xl sm:text-4xl font-bold balance-display mb-2">
              $<span id="total-balance">0.00</span>
            </h2>
            <p class="text-gray-400">Total Portfolio Value</p>
            <div class="flex items-center mt-2">
              <span id="balance-change" class="text-sm font-medium price-neutral">$0.00 (0.00%)</span>
              <span class="text-xs text-gray-500 ml-2">24h</span>
            </div>
          </div>
          <div class="mt-4 sm:mt-0 w-full sm:w-1/2 lg:w-1/3">
            <div class="chart-container">
              <canvas id="portfolio-chart"></canvas>
            </div>
          </div>
        </div>
        <!-- Quick Actions -->
        <div class="action-buttons grid grid-cols-2 sm:grid-cols-4 gap-3">
          <button onclick="showSendModal()"
            class="modern-card flex flex-col items-center p-4 hover:bg-orange-500 hover:bg-opacity-20 transition-all">
            <i class="fas fa-paper-plane w-6 h-6 mb-2 text-orange-500"></i>
            <span class="text-sm font-medium">Send</span>
          </button>
          <button onclick="showReceiveModal()"
            class="modern-card flex flex-col items-center p-4 hover:bg-orange-500 hover:bg-opacity-20 transition-all">
            <i class="fas fa-qrcode w-6 h-6 mb-2 text-green-500"></i>
            <span class="text-sm font-medium">Receive</span>
          </button>
          <button onclick="showBuyModal()"
            class="modern-card flex flex-col items-center p-4 hover:bg-orange-500 hover:bg-opacity-20 transition-all">
            <i class="fas fa-credit-card w-6 h-6 mb-2 text-blue-500"></i>
            <span class="text-sm font-medium">Buy</span>
          </button>
          <button onclick="showSwapModal()"
            class="modern-card flex flex-col items-center p-4 hover:bg-orange-500 hover:bg-opacity-20 transition-all">
            <i class="fas fa-exchange-alt w-6 h-6 mb-2 text-purple-500"></i>
            <span class="text-sm font-medium">Swap</span>
          </button>
        </div>
      </div>
      <!-- Portfolio Grid -->
      <div class="portfolio-grid grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Assets -->
        <div class="modern-card p-6" data-aos="fade-right">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-semibold">Your Assets</h3>
            <button class="text-orange-500 hover:text-orange-400 text-sm font-medium">View All</button>
          </div>
          <div id="assets-list" class="space-y-4">
            <!-- Assets will be loaded here -->
          </div>
        </div>
        <!-- Recent Transactions -->
        <div class="modern-card p-6" data-aos="fade-left">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-semibold">Recent Activity</h3>
            <button class="text-orange-500 hover:text-orange-400 text-sm font-medium">View All</button>
          </div>
          <div id="transactions-list" class="space-y-4">
            <!-- Transactions will be loaded here -->
          </div>
        </div>
      </div>

      <!-- Mobile User ID Display - NEW LOCATION -->
      <div class="modern-card p-6 mb-8 sm:hidden" data-aos="fade-up">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <h3 class="text-lg font-semibold mb-2">Your User ID</h3>
            <p id="mobile-user-unique-id" class="text-lg font-mono text-orange-500 break-all">Loading...</p>
            <p class="text-sm text-gray-400 mt-1">Use this ID for support and referrals</p>
          </div>
          <button id="copy-mobile-user-id"
            class="copy-button p-3 rounded-lg hover:bg-orange-500 hover:bg-opacity-20 transition-all ml-4"
            aria-label="Copy User ID">
            <i class="fas fa-copy text-orange-500 text-lg"></i>
          </button>
        </div>
      </div>

      <!-- Market Overview -->
      <div class="modern-card p-6" data-aos="fade-up">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold">Market Overview</h3>
          <div class="flex items-center space-x-2">
            <button class="text-sm px-3 py-1 rounded-lg bg-orange-500 bg-opacity-20 text-orange-500">24H</button>
            <button
              class="text-sm px-3 py-1 rounded-lg hover:bg-orange-500 hover:bg-opacity-20 transition-all">7D</button>
            <button
              class="text-sm px-3 py-1 rounded-lg hover:bg-orange-500 hover:bg-opacity-20 transition-all">30D</button>
          </div>
        </div>
        <div id="market-overview" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Market data will be loaded here -->
        </div>
      </div>
    </div>
    <!-- Other sections remain the same for now... -->
    <!-- Portfolio Section -->
    <div id="portfolio-section" class="section-content hidden p-4 sm:p-6 lg:p-8">
      <div class="mb-8" data-aos="fade-up">
        <h2 class="text-2xl font-bold mb-2">Portfolio Analytics</h2>
        <p class="text-gray-400">Detailed view of your cryptocurrency holdings and performance</p>
      </div>
      <!-- Portfolio Stats -->
      <div class="stats-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="modern-card p-6 text-center" data-aos="fade-up" data-aos-delay="100">
          <div class="text-2xl font-bold balance-display mb-2" id="portfolio-total-value">$0.00</div>
          <div class="text-sm text-gray-400">Total Value</div>
          <div class="text-sm text-green-500 mt-1" id="portfolio-total-change">+0.00%</div>
        </div>
        <div class="modern-card p-6 text-center" data-aos="fade-up" data-aos-delay="200">
          <div class="text-2xl font-bold balance-display mb-2" id="portfolio-24h-pnl">+$0.00</div>
          <div class="text-sm text-gray-400">24h P&L</div>
          <div class="text-sm text-green-500 mt-1" id="portfolio-24h-change">+0.00%</div>
        </div>
        <div class="modern-card p-6 text-center" data-aos="fade-up" data-aos-delay="300">
          <div class="text-2xl font-bold balance-display mb-2" id="portfolio-assets-count">0</div>
          <div class="text-sm text-gray-400">Assets</div>
          <div class="text-sm text-blue-500 mt-1">Diversified</div>
        </div>
        <div class="modern-card p-6 text-center" data-aos="fade-up" data-aos-delay="400">
          <div class="text-2xl font-bold balance-display mb-2">0.0%</div>
          <div class="text-sm text-gray-400">Success Rate</div>
          <div class="text-sm text-green-500 mt-1">Getting Started</div>
        </div>
      </div>
      <!-- Detailed Portfolio -->
      <div class="modern-card p-6" data-aos="fade-up">
        <h3 class="text-xl font-semibold mb-6">Asset Allocation</h3>
        <div id="portfolio-assets-list" class="space-y-4">
          <!-- Portfolio items will be loaded here -->
        </div>
      </div>
    </div>
    <!-- Trading Section -->
    <div id="trading-section" class="section-content hidden p-4 sm:p-6 lg:p-8">
      <div class="mb-8" data-aos="fade-up">
        <h2 class="text-2xl font-bold mb-2">Trading Terminal</h2>
        <p class="text-gray-400">Advanced trading tools and real-time market data</p>
      </div>
      <!-- Trading Interface -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Order Book -->
        <div class="modern-card p-6" data-aos="fade-up" data-aos-delay="100">
          <h3 class="text-lg font-semibold mb-4">Order Book</h3>
          <div class="space-y-2">
            <div class="flex justify-between text-xs text-gray-400 mb-2">
              <span>Price (USD)</span>
              <span>Amount (BTC)</span>
            </div>
            <div id="order-book-sells"></div>
            <div class="text-center font-bold text-lg text-orange-500 py-2" id="current-price">$0.00</div>
            <div id="order-book-buys"></div>
          </div>
        </div>
        <!-- Trading Form -->
        <div class="modern-card p-6" data-aos="fade-up" data-aos-delay="200">
          <h3 class="text-lg font-semibold mb-4">Place Order</h3>
          <form id="trading-form" class="space-y-4">
            <div class="flex space-x-2">
              <button type="button" id="buy-btn"
                class="flex-1 py-2 px-4 bg-green-500 bg-opacity-20 text-green-500 rounded-lg">Buy</button>
              <button type="button" id="sell-btn"
                class="flex-1 py-2 px-4 bg-red-500 bg-opacity-20 text-red-500 rounded-lg">Sell</button>
            </div>
            <div>
              <label for="trade-amount" class="block text-sm font-medium mb-2">Amount</label>
              <input type="number" id="trade-amount"
                class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none"
                placeholder="0.00" step="0.00000001">
            </div>
            <div>
              <label for="trade-price" class="block text-sm font-medium mb-2">Price</label>
              <input type="number" id="trade-price"
                class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none"
                placeholder="0.00" step="0.01">
            </div>
            <div class="text-sm text-gray-400">
              Total: $<span id="trade-total">0.00</span>
            </div>
            <button type="submit" class="btn-primary w-full py-3 rounded-lg font-semibold">Place Order</button>
          </form>
        </div>
        <!-- Recent Trades -->
        <div class="modern-card p-6" data-aos="fade-up" data-aos-delay="300">
          <h3 class="text-lg font-semibold mb-4">Recent Trades</h3>
          <div class="space-y-2">
            <div class="flex justify-between text-xs text-gray-400 mb-2">
              <span>Time</span>
              <span>Price</span>
              <span>Amount</span>
            </div>
            <div id="recent-trades-list"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- Transactions Section -->
    <div id="transactions-section" class="section-content hidden p-4 sm:p-6 lg:p-8">
      <div class="mb-8" data-aos="fade-up">
        <h2 class="text-2xl font-bold mb-2">Transaction History</h2>
        <p class="text-gray-400">Complete record of all your cryptocurrency transactions</p>
      </div>
      <!-- Transaction Filters -->
      <div class="modern-card p-6 mb-6" data-aos="fade-up">
        <div class="grid grid-cols-1 sm:grid-cols-4 gap-4">
          <select id="transaction-type-filter"
            class="p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
            <option value="All Types">All Types</option>
            <option value="send">Send</option>
            <option value="receive">Receive</option>
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
            <option value="swap">Swap</option>
            <option value="stake">Stake</option>
          </select>
          <select id="transaction-asset-filter"
            class="p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
            <option value="All Assets">All Assets</option>
            <option value="BTC">Bitcoin</option>
            <option value="ETH">Ethereum</option>
            <option value="BNB">BNB</option>
            <option value="USDT">Tether (ERC20)</option>
            <option value="TRC20">Tether (TRC20)</option>
            <option value="SOL">Solana</option>
            <option value="DOGE">Dogecoin</option>
            <option value="ADA">Cardano</option>
            <option value="MATIC">Polygon</option>
          </select>
          <input type="date" id="transaction-date-filter"
            class="p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
          <button id="filter-transactions-btn" class="btn-primary py-3 rounded-lg font-semibold">Filter</button>
        </div>
      </div>
      <!-- Transaction List -->
      <div class="modern-card p-6" data-aos="fade-up">
        <div id="transaction-history" class="space-y-4">
          <!-- Transaction history will be loaded here -->
        </div>
      </div>
    </div>
    <!-- Staking Section -->
    <div id="staking-section" class="section-content hidden p-4 sm:p-6 lg:p-8">
      <div class="mb-8" data-aos="fade-up">
        <h2 class="text-2xl font-bold mb-2">Staking Rewards</h2>
        <p class="text-gray-400">Earn passive income by staking your cryptocurrencies</p>
      </div>
      <!-- Staking Overview -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
        <div class="modern-card p-6 text-center" data-aos="fade-up" data-aos-delay="100">
          <div class="text-2xl font-bold balance-display mb-2" id="total-staked">$0.00</div>
          <div class="text-sm text-gray-400">Total Staked</div>
          <div class="text-sm text-green-500 mt-1">+0.00% APY</div>
        </div>
        <div class="modern-card p-6 text-center" data-aos="fade-up" data-aos-delay="200">
          <div class="text-2xl font-bold balance-display mb-2" id="rewards-earned">$0.00</div>
          <div class="text-sm text-gray-400">Rewards Earned</div>
          <div class="text-sm text-green-500 mt-1">This Month</div>
        </div>
        <div class="modern-card p-6 text-center" data-aos="fade-up" data-aos-delay="300">
          <div class="text-2xl font-bold balance-display mb-2" id="active-stakes">0</div>
          <div class="text-sm text-gray-400">Active Stakes</div>
          <div class="text-sm text-blue-500 mt-1">Validators</div>
        </div>
      </div>
      <!-- Available Staking Options -->
      <div class="modern-card p-6" data-aos="fade-up">
        <h3 class="text-xl font-semibold mb-6">Available Staking Options</h3>
        <div id="staking-options-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Staking options will be loaded here -->
        </div>
      </div>
    </div>
    <!-- Settings Section -->
    <div id="settings-section" class="section-content hidden p-4 sm:p-6 lg:p-8">
      <div class="mb-8" data-aos="fade-up">
        <h2 class="text-2xl font-bold mb-2">Account Settings</h2>
        <p class="text-gray-400">Manage your account preferences and security settings</p>
      </div>
      <!-- Settings Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Profile Settings -->
        <div class="modern-card p-6" data-aos="fade-right">
          <h3 class="text-lg font-semibold mb-4">Profile Information</h3>
          <form id="profile-settings-form" class="space-y-4">
            <div class="flex justify-center mb-6">
              <div class="profile-image-container">
                <img id="settings-avatar" src="/placeholder.svg?height=80&width=80" alt="Profile Avatar"
                  class="w-20 h-20 rounded-full object-cover">
                <div class="profile-image-upload" onclick="triggerImageUpload()">
                  <i class="fas fa-camera text-white text-sm"></i>
                </div>
              </div>
            </div>
            <div>
              <label for="settings-name" class="block text-sm font-medium mb-2">Display Name</label>
              <input type="text" id="settings-name"
                class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
            </div>
            <div>
              <label for="settings-email" class="block text-sm font-medium mb-2">Email Address</label>
              <input type="email" id="settings-email"
                class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none"
                readonly>
            </div>
            <div class="user-id-container">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <p class="text-sm font-medium mb-1">Your Unique User ID</p>
                  <p id="settings-user-id" class="text-sm font-mono text-orange-500">Loading...</p>
                </div>
                <button type="button" id="copy-settings-user-id"
                  class="copy-button p-2 rounded-lg hover:bg-orange-500 hover:bg-opacity-20 transition-all"
                  aria-label="Copy User ID">
                  <i class="fas fa-copy text-orange-500"></i>
                </button>
              </div>
            </div>
            <button type="submit" class="btn-primary px-6 py-3 rounded-lg font-semibold">Update Profile</button>
          </form>
        </div>
        <!-- Security Settings -->
        <div class="modern-card p-6" data-aos="fade-left">
          <h3 class="text-lg font-semibold mb-4">Security</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between p-4 glass-effect rounded-lg">
              <div>
                <div class="font-medium">Two-Factor Authentication</div>
                <div class="text-sm text-gray-400">Add an extra layer of security</div>
              </div>
              <button class="bg-green-500 bg-opacity-20 text-green-500 px-4 py-2 rounded-lg text-sm">Enabled</button>
            </div>
            <div class="flex items-center justify-between p-4 glass-effect rounded-lg">
              <div>
                <div class="font-medium">Email Notifications</div>
                <div class="text-sm text-gray-400">Receive transaction alerts</div>
              </div>
              <button
                class="bg-orange-500 bg-opacity-20 text-orange-500 px-4 py-2 rounded-lg text-sm">Configure</button>
            </div>
            <div class="flex items-center justify-between p-4 glass-effect rounded-lg">
              <div>
                <div class="font-medium">API Access</div>
                <div class="text-sm text-gray-400">Manage API keys</div>
              </div>
              <button class="bg-blue-500 bg-opacity-20 text-blue-500 px-4 py-2 rounded-lg text-sm">Manage</button>
            </div>
            <div class="flex items-center justify-between p-4 glass-effect rounded-lg">
              <div>
                <div class="font-medium">Change Password</div>
                <div class="text-sm text-gray-400">Update your account password</div>
              </div>
              <button class="bg-purple-500 bg-opacity-20 text-purple-500 px-4 py-2 rounded-lg text-sm">Change</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <!-- Fixed Bottom Navigation (Mobile) -->
  <nav class="bottom-nav">
    <div class="flex items-center justify-around w-full">
      <button class="nav-item active" data-section="dashboard" aria-label="Dashboard">
        <i class="fas fa-home"></i>
        <span>Dashboard</span>
      </button>
      <button class="nav-item" data-section="portfolio" aria-label="Portfolio">
        <i class="fas fa-chart-pie"></i>
        <span>Portfolio</span>
      </button>
      <button class="nav-item" data-section="trading" aria-label="Trading">
        <i class="fas fa-chart-line"></i>
        <span>Trading</span>
      </button>
      <button class="nav-item" data-section="transactions" aria-label="History">
        <i class="fas fa-exchange-alt"></i>
        <span>History</span>
      </button>
      <button class="nav-item" data-section="settings" aria-label="Settings">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
      </button>
    </div>
  </nav>
  <!-- Floating Action Button (Mobile) -->
  <button class="fab" onclick="showReceiveModal()" aria-label="Quick Receive">
    <i class="fas fa-qrcode"></i>
  </button>
  <!-- ETH Warning Modal -->
  <div id="eth-warning-modal" class="eth-warning-modal" style="display: none;">
    <div class="eth-warning-content">
      <div class="eth-warning-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3 class="eth-warning-title">Warning?</h3>
      <p class="eth-warning-message">
        You do not have enough ETHEREUM(ERC20) to cover your network fees!
      </p>
      <button class="eth-warning-button" onclick="closeEthWarning()">
        Understood
      </button>
    </div>
  </div>
  <!-- Modals -->
  <!-- Send Modal -->
  <div id="send-modal" class="modal">
    <div class="modal-content glass-effect">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold orbitron">Send Cryptocurrency</h3>
        <button class="close-modal p-2 rounded-lg hover:bg-gray-700 transition-colors" aria-label="Close modal">
          <i class="fas fa-times w-6 h-6"></i>
        </button>
      </div>
      <form id="send-form" class="space-y-4">
        <div>
          <label for="send-asset" class="block text-sm font-medium mb-2">Select Asset</label>
          <select id="send-asset"
            class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
            <option value="BTC">Bitcoin (BTC)</option>
            <option value="ETH">Ethereum (ETH)</option>
            <option value="BNB">BNB (BNB)</option>
            <option value="USDT">Tether (ERC20)</option>
            <option value="TRC20">Tether (TRC20)</option>
            <option value="SOL">Solana (SOL)</option>
            <option value="DOGE">Dogecoin (DOGE)</option>
            <option value="ADA">Cardano (ADA)</option>
            <option value="MATIC">Polygon (MATIC)</option>
          </select>
        </div>
        <div>
          <label for="recipient-address" class="block text-sm font-medium mb-2">Recipient Address</label>
          <input type="text" id="recipient-address"
            class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none"
            placeholder="Enter wallet address" required>
          <div class="text-xs text-gray-400 mt-1">Make sure the address is correct. Transactions cannot be reversed.
          </div>
        </div>
        <div>
          <label for="send-amount" class="block text-sm font-medium mb-2">Amount</label>
          <div class="relative">
            <input type="number" id="send-amount"
              class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none"
              placeholder="0.00" step="0.00000001" required>
            <div class="absolute right-3 top-3 text-sm text-gray-400">
              Available: <span id="send-available-balance">0.00</span>
            </div>
          </div>
        </div>
        <div class="glass-effect rounded-lg p-4">
          <div class="flex justify-between text-sm font-medium">
            <span>Total</span>
            <span id="send-total">$0.00</span>
          </div>
        </div>
        <div class="flex gap-3">
          <button type="button" class="close-modal flex-1 py-3 glass-effect rounded-lg font-semibold">Cancel</button>
          <button type="submit" class="btn-primary flex-1 py-3 rounded-lg font-semibold">Send</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Receive Modal with Real QR Codes -->
  <div id="receive-modal" class="modal">
    <div class="modal-content glass-effect">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold orbitron">Receive Cryptocurrency</h3>
        <button class="close-modal p-2 rounded-lg hover:bg-gray-700 transition-colors" aria-label="Close modal">
          <i class="fas fa-times w-6 h-6"></i>
        </button>
      </div>
      <div class="text-center">
        <div class="mb-4">
          <label for="receive-asset" class="block text-sm font-medium mb-2">Select Asset</label>
          <select id="receive-asset"
            class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
            <option value="btc">Bitcoin (BTC)</option>
            <option value="eth">Ethereum (ETH)</option>
            <option value="bnb">BNB (BNB)</option>
            <option value="usdt">Tether (ERC20)</option>
            <option value="trc20">Tether (TRC20)</option>
            <option value="ada">Cardano (ADA)</option>
          </select>
        </div>
        <div class="qr-container">
          <div class="qr-code-display">
            <img id="receive-qr-image"
              src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/BTC%28Bitcoin%29.JPG-5Oh8mFt67VGb9kAiYSmbP5hD0UgM09.jpeg"
              alt="QR Code" class="w-48 h-48 object-contain">
          </div>
        </div>
        <div id="receive-address" class="bg-gray-800 p-4 rounded-lg mt-4 break-all font-mono text-sm">
          bc1qr6vn5w2mxnm33cwtpm8tnvenvnwx4unu8szn0z</div>
        <div class="text-xs text-gray-400 mt-2">
          Only send <span id="receive-asset-name">Bitcoin</span> to this address. Sending other assets may result in
          permanent loss.
        </div>
        <div class="flex gap-3 mt-6">
          <button id="copy-address" class="btn-primary flex-1 py-3 rounded-lg font-semibold">
            <i class="fas fa-copy w-5 h-5 mr-2"></i>
            Copy Address
          </button>
          <button id="share-address" class="glass-effect flex-1 py-3 rounded-lg font-semibold">
            <i class="fas fa-share w-5 h-5 mr-2"></i>
            Share
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Buy Modal -->
  <div id="buy-modal" class="modal">
    <div class="modal-content glass-effect">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold orbitron">Buy Cryptocurrency</h3>
        <button class="close-modal p-2 rounded-lg hover:bg-gray-700 transition-colors" aria-label="Close modal">
          <i class="fas fa-times w-6 h-6"></i>
        </button>
      </div>
      <form id="buy-form" class="space-y-4">
        <div>
          <label for="buy-crypto" class="block text-sm font-medium mb-2">Select Cryptocurrency</label>
          <select id="buy-crypto"
            class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
            <option value="BTC">Bitcoin (BTC)</option>
            <option value="BNB">BNB (BNB)</option>
            <option value="USDT">Tether (ERC20)</option>
            <option value="TRC20">Tether (TRC20)</option>
            <option value="SOL">Solana (SOL)</option>
            <option value="DOGE">Dogecoin (DOGE)</option>
            <option value="ADA">Cardano (ADA)</option>
            <option value="MATIC">Polygon (MATIC)</option>
          </select>
        </div>
        <div>
          <label for="buy-amount-usd" class="block text-sm font-medium mb-2">Amount (USD)</label>
          <input type="number" id="buy-amount-usd"
            class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none"
            placeholder="100.00" min="10" step="0.01" required>
          <div class="text-xs text-gray-400 mt-1">Minimum purchase: $10.00</div>
        </div>
        <div>
          <label for="payment-method" class="block text-sm font-medium mb-2">Payment Method</label>
          <select id="payment-method"
            class="w-full p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
            <option value="card">Credit/Debit Card</option>
            <option value="bank">Bank Transfer</option>
            <option value="paypal">PayPal</option>
            <option value="apple">Apple Pay</option>
            <option value="google">Google Pay</option>
          </select>
        </div>
        <div class="glass-effect rounded-lg p-4">
          <div class="flex justify-between text-sm mb-2">
            <span>Processing Fee</span>
            <span id="buy-processing-fee">$0.00</span>
          </div>
          <div class="flex justify-between text-sm font-medium">
            <span>You'll Receive</span>
            <span id="buy-crypto-amount">0.00000000</span>
          </div>
        </div>
        <div class="flex gap-3">
          <button type="button" class="close-modal flex-1 py-3 glass-effect rounded-lg font-semibold">Cancel</button>
          <button type="submit" class="btn-primary flex-1 py-3 rounded-lg font-semibold">Buy Now</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Swap Modal -->
  <div id="swap-modal" class="modal">
    <div class="modal-content glass-effect">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold orbitron">Swap Cryptocurrency</h3>
        <button class="close-modal p-2 rounded-lg hover:bg-gray-700 transition-colors" aria-label="Close modal">
          <i class="fas fa-times w-6 h-6"></i>
        </button>
      </div>
      <form id="swap-form" class="space-y-4">
        <div>
          <label for="swap-from-asset" class="block text-sm font-medium mb-2">From</label>
          <div class="flex space-x-2">
            <select id="swap-from-asset"
              class="flex-1 p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
              <option value="BTC">Bitcoin (BTC)</option>
              <option value="BNB">BNB (BNB)</option>
              <option value="USDT">Tether (ERC20)</option>
              <option value="TRC20">Tether (TRC20)</option>
              <option value="SOL">Solana (SOL)</option>
              <option value="DOGE">Dogecoin (DOGE)</option>
              <option value="ADA">Cardano (ADA)</option>
              <option value="MATIC">Polygon (MATIC)</option>
            </select>
            <input type="number" id="swap-from-amount"
              class="flex-1 p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none"
              placeholder="0.00" step="0.00000001" required>
          </div>
          <div class="text-xs text-gray-400 mt-1">
            Available: <span id="swap-available-balance">0.00</span>
          </div>
        </div>
        <div class="flex justify-center">
          <button type="button" id="swap-direction-btn"
            class="p-2 rounded-full glass-effect hover:bg-orange-500 hover:bg-opacity-20 transition-all"
            aria-label="Swap direction">
            <i class="fas fa-exchange-alt w-6 h-6"></i>
          </button>
        </div>
        <div>
          <label for="swap-to-asset" class="block text-sm font-medium mb-2">To</label>
          <div class="flex space-x-2">
            <select id="swap-to-asset"
              class="flex-1 p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
              <option value="BTC">Bitcoin (BTC)</option>
              <option value="BNB">BNB (BNB)</option>
              <option value="USDT">Tether (ERC20)</option>
              <option value="TRC20">Tether (TRC20)</option>
              <option value="SOL">Solana (SOL)</option>
              <option value="DOGE">Dogecoin (DOGE)</option>
              <option value="ADA">Cardano (ADA)</option>
              <option value="MATIC">Polygon (MATIC)</option>
            </select>
            <input type="number" id="swap-to-amount"
              class="flex-1 p-3 glass-effect rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none"
              placeholder="0.00" readonly>
          </div>
        </div>
        <div class="glass-effect rounded-lg p-4">
          <div class="flex justify-between text-sm mb-2">
            <span>Exchange Rate</span>
            <span id="swap-rate">1 BTC = 0 USDT</span>
          </div>
          <div class="flex justify-between text-sm mb-2">
            <span>Network Fee</span>
            <span id="swap-network-fee">~$2.50</span>
          </div>
          <div class="flex justify-between text-sm font-medium">
            <span>Minimum Received</span>
            <span id="swap-minimum">0.00</span>
          </div>
        </div>
        <div class="flex gap-3">
          <button type="button" class="close-modal flex-1 py-3 glass-effect rounded-lg font-semibold">Cancel</button>
          <button type="submit" class="btn-primary flex-1 py-3 rounded-lg font-semibold">Swap</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module">
    // Firebase Config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut,
      updateProfile as firebaseUpdateProfile
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      updateDoc,
      serverTimestamp,
      setDoc,
      query,
      collection,
      where,
      orderBy,
      limit,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import {
      getStorage,
      ref,
      uploadBytes,
      getDownloadURL
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD6enbTO-nNYVyrNLRP-Av6ghguL3--Nvw",
      authDomain: "safvacut-web-wallet.firebaseapp.com",
      projectId: "safvacut-web-wallet",
      storageBucket: "safvacut-web-wallet.appspot.com",
      messagingSenderId: "976916444641",
      appId: "1:976916444641:web:4c6a6ad09c43a7ccda0ea0",
      measurementId: "G-0QCL2TQCB6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    let currentUser = null;
    let userProfile = null;
    let portfolioChartInstance = null;
    let userWalletData = {
      balances: {},
      transactions: [],
      totalValue: 0
    };

    // Real Wallet addresses with QR codes
    const walletAddresses = {
      btc: {
        address: 'bc1qr6vn5w2mxnm33cwtpm8tnvenvnwx4unu8szn0z',
        qrImage: 'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/BTC%28Bitcoin%29.JPG-5Oh8mFt67VGb9kAiYSmbP5hD0UgM09.jpeg'
      },
      eth: {
        address: '0xD2B475710CCd8a48B2fD20Ff7D8cd5360c428ba2',
        qrImage: 'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/ETH.JPG-erHe6KpUosJF7pe7gTWj5nTma6YvxY.jpeg'
      },
      bnb: {
        address: '0xFc940b52E7E5feb789becbf3ca47804C29aa3D82',
        qrImage: 'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/IMG_20250731_205556_092.jpg-diPF62mf4bwtVUYHgebQqYdXHt2x7A.jpeg'
      },
      usdt: {
        address: '0xD2B475710CCd8a48B2fD20Ff7D8cd5360c428ba2',
        qrImage: 'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/USDT%28Etherum%29.JPG-7uCAepLluINt17QRDHHmbiQa0XYBbB.jpeg'
      },
      trc20: {
        address: 'TZ359zm5ixt1LcwSVZNErBGqq JujBhiX8e',
        qrImage: 'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/USDT%28Tron%29.JPG-4SkUFz7ualnfnhJ2NEyDJbjxltBdBE.jpeg'
      },
      ada: {
        address: 'addr1q9jjkfw7wjqle004ax8xjcs6evydtws5k699yd9qgv9j9hnjuxyhel0qz0r4pyr9f30m8nqnffkc25xv4h5prqw90mjash0wk09',
        qrImage: 'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/IMG_20250731_205551_653.jpg-2tWDwkOKJUpZTsjklkTXBrvPVnT5Cx.jpeg'
      }
    };

    // Available wallets with individual pages
    const availableWallets = ['BTC', 'ETH', 'BNB', 'USDT', 'TRC20', 'ADA'];

    // Real-time crypto data integration
    let cryptoAssets = [];
    let realTimePrices = {};

    // Fetch real-time crypto prices from CoinGecko API
    async function fetchRealTimePrices() {
      try {
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,binancecoin,tether,solana,dogecoin,cardano,matic-network&vs_currencies=usd&include_24hr_change=true');
        const data = await response.json();

        realTimePrices = {
          BTC: { price: data.bitcoin.usd, change: data.bitcoin.usd_24h_change },
          ETH: { price: data.ethereum.usd, change: data.ethereum.usd_24h_change },
          BNB: { price: data.binancecoin.usd, change: data.binancecoin.usd_24h_change },
          USDT: { price: data.tether.usd, change: data.tether.usd_24h_change },
          TRC20: { price: data.tether.usd, change: data.tether.usd_24h_change },
          SOL: { price: data.solana.usd, change: data.solana.usd_24h_change },
          DOGE: { price: data.dogecoin.usd, change: data.dogecoin.usd_24h_change },
          ADA: { price: data.cardano.usd, change: data.cardano.usd_24h_change },
          MATIC: { price: data['matic-network'].usd, change: data['matic-network'].usd_24h_change }
        };

        // Update crypto assets with real data
        cryptoAssets = [
          {
            symbol: 'BTC',
            name: 'Bitcoin',
            price: realTimePrices.BTC.price,
            change: realTimePrices.BTC.change,
            iconClass: 'crypto-icon-bitcoin',
            network: 'Bitcoin'
          },
          {
            symbol: 'ETH',
            name: 'Ethereum',
            price: realTimePrices.ETH.price,
            change: realTimePrices.ETH.change,
            iconClass: 'crypto-icon-ethereum',
            network: 'Ethereum'
          },
          {
            symbol: 'BNB',
            name: 'BNB',
            price: realTimePrices.BNB.price,
            change: realTimePrices.BNB.change,
            iconClass: 'crypto-icon-bnb',
            network: 'BSC'
          },
          {
            symbol: 'USDT',
            name: 'Tether (ERC20)',
            price: realTimePrices.USDT.price,
            change: realTimePrices.USDT.change,
            iconClass: 'crypto-icon-usdt',
            network: 'Ethereum'
          },
          {
            symbol: 'TRC20',
            name: 'Tether (TRC20)',
            price: realTimePrices.TRC20.price,
            change: realTimePrices.TRC20.change,
            iconClass: 'crypto-icon-trc20',
            network: 'Tron'
          },
          {
            symbol: 'SOL',
            name: 'Solana',
            price: realTimePrices.SOL.price,
            change: realTimePrices.SOL.change,
            iconClass: 'crypto-icon-solana',
            network: 'Solana'
          },
          {
            symbol: 'DOGE',
            name: 'Dogecoin',
            price: realTimePrices.DOGE.price,
            change: realTimePrices.DOGE.change,
            iconClass: 'crypto-icon-doge',
            network: 'Dogecoin'
          },
          {
            symbol: 'ADA',
            name: 'Cardano',
            price: realTimePrices.ADA.price,
            change: realTimePrices.ADA.change,
            iconClass: 'crypto-icon-cardano',
            network: 'Cardano'
          },
          {
            symbol: 'MATIC',
            name: 'Polygon',
            price: realTimePrices.MATIC.price,
            change: realTimePrices.MATIC.change,
            iconClass: 'crypto-icon-polygon',
            network: 'Polygon'
          }
        ];

        // Update UI with real data
        loadAllContent();
      } catch (error) {
        console.error('Error fetching real-time prices:', error);
        // Fallback to mock data if API fails
        initializeFallbackData();
      }
    }

    // Fallback data if API fails
    function initializeFallbackData() {
      cryptoAssets = [
        {
          symbol: 'BTC',
          name: 'Bitcoin',
          price: 45234.67,
          change: 2.34,
          iconClass: 'crypto-icon-bitcoin',
          network: 'Bitcoin'
        },
        {
          symbol: 'ETH',
          name: 'Ethereum',
          price: 2834.12,
          change: -1.23,
          iconClass: 'crypto-icon-ethereum',
          network: 'Ethereum'
        }
      ];
    }

    // Critical ETH Balance Check Function
    function checkEthBalance() {
      const ethBalance = userWalletData.balances['ETH'] || 0;
      const minimumEthRequired = 0.7; // 0.7 ETH minimum requirement
      if (ethBalance < minimumEthRequired) {
        showEthWarning();
        return false;
      }
      return true;
    }

    function showEthWarning() {
      document.getElementById('eth-warning-modal').style.display = 'flex';
    }

    function closeEthWarning() {
      document.getElementById('eth-warning-modal').style.display = 'none';
    }

    // Make closeEthWarning globally available
    window.closeEthWarning = closeEthWarning;

    // Generate unique user ID - UPDATED TO INCLUDE NUMBERS
    function generateUniqueId() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let result = 'USR';
      for (let i = 0; i < 8; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    // Initialize user wallet with zero balances - PRODUCTION READY
    function initializeUserWallet() {
      const balances = {};
      cryptoAssets.forEach(asset => {
        balances[asset.symbol] = 0; // All balances start at 0 for production
      });

      userWalletData = {
        balances: balances,
        transactions: [],
        totalValue: 0
      };
    }

    // Calculate total portfolio value
    function calculateTotalValue() {
      let total = 0;
      Object.keys(userWalletData.balances).forEach(symbol => {
        const asset = cryptoAssets.find(a => a.symbol === symbol);
        if (asset) {
          total += userWalletData.balances[symbol] * asset.price;
        }
      });
      userWalletData.totalValue = total;
      return total;
    }

    // Add transaction to user's history
    function addTransaction(type, asset, amount, value, status = 'completed') {
      const transaction = {
        id: Date.now().toString(),
        type: type,
        asset: asset,
        amount: amount,
        value: value,
        status: status,
        timestamp: new Date(),
        hash: '0x' + Math.random().toString(16).substr(2, 8) + '...'
      };

      userWalletData.transactions.unshift(transaction);

      // Keep only last 100 transactions
      if (userWalletData.transactions.length > 100) {
        userWalletData.transactions = userWalletData.transactions.slice(0, 100);
      }

      // Save to Firestore
      saveUserWalletData();
      return transaction;
    }

    // Save user wallet data to Firestore
    async function saveUserWalletData() {
      if (!currentUser) return;

      try {
        const userDocRef = doc(db, "users", currentUser.uid);
        await updateDoc(userDocRef, {
          walletData: userWalletData,
          updatedAt: serverTimestamp()
        });
      } catch (error) {
        console.error('Error saving wallet data:', error);
      }
    }

    // Load user wallet data from Firestore
    async function loadUserWalletData() {
      if (!currentUser) return;

      try {
        const userDocRef = doc(db, "users", currentUser.uid);
        const userDocSnap = await getDoc(userDocRef);

        if (userDocSnap.exists() && userDocSnap.data().walletData) {
          userWalletData = userDocSnap.data().walletData;
        } else {
          initializeUserWallet();
          await saveUserWalletData();
        }
      } catch (error) {
        console.error('Error loading wallet data:', error);
        initializeUserWallet();
      }
    }

    // Open individual crypto wallet - Handle missing pages gracefully
    window.openCryptoWallet = function (symbol) {
      const asset = cryptoAssets.find(a => a.symbol === symbol);
      if (!asset) return;

      // Check if wallet has individual page
      if (availableWallets.includes(symbol)) {
        // Navigate to individual wallet page with Firebase integration
        window.location.href = `individual-wallet.html?symbol=${symbol}`;
      } else {
        // Show coming soon message for wallets without pages
        Swal.fire({
          title: `${asset.name} Wallet`,
          text: 'Individual wallet page coming soon! You can still send and receive using the main dashboard.',
          icon: 'info',
          confirmButtonColor: '#f7931a',
          background: 'rgba(15, 15, 35, 0.9)',
          color: '#ffffff'
        });
      }
    };

    // Initialize dashboard
    function initializeDashboard() {
      loadUserProfile();
      setupEventListeners();
      setupNavigation();
      setupModals();
      initializeChart();

      // Fetch real-time data
      fetchRealTimePrices();

      // Update prices every 30 seconds
      setInterval(fetchRealTimePrices, 30000);

      // Initialize AOS
      AOS.init({
        duration: 800,
        easing: 'ease-in-out',
        once: true
      });
    }

    // Load user profile from localStorage and Firebase
    async function loadUserProfile() {
      try {
        const storedUser = localStorage.getItem('safvacut_user');
        const authTime = localStorage.getItem('safvacut_auth_time');

        if (storedUser && authTime) {
          const userData = JSON.parse(storedUser);
          const timeDiff = Date.now() - parseInt(authTime);

          if (timeDiff < 3600000) { // Data less than 1 hour old
            currentUser = userData;
            userProfile = userData;
            await loadUserWalletData();
            updateUIWithUserData(userData);
            loadAllContent();
            return;
          }
        }

        // If no valid localStorage data, check Firebase auth state
        onAuthStateChanged(auth, async (user) => {
          if (user) {
            currentUser = user;
            const userDocRef = doc(db, "users", user.uid);
            const userDocSnap = await getDoc(userDocRef);

            if (userDocSnap.exists()) {
              userProfile = userDocSnap.data();
              // Generate unique ID if not exists
              if (!userProfile.uniqueId) {
                const uniqueId = generateUniqueId();
                await updateDoc(userDocRef, { uniqueId: uniqueId });
                userProfile.uniqueId = uniqueId;
              }
            } else {
              // If no profile in Firestore, create one with unique ID
              const uniqueId = generateUniqueId();
              userProfile = {
                displayName: user.displayName,
                email: user.email,
                photoURL: user.photoURL,
                uid: user.uid,
                uniqueId: uniqueId
              };

              await setDoc(userDocRef, {
                uniqueId: uniqueId,
                displayName: user.displayName,
                email: user.email,
                photoURL: user.photoURL,
                createdAt: serverTimestamp()
              });
            }

            await loadUserWalletData();
            localStorage.setItem('safvacut_user', JSON.stringify(userProfile));
            localStorage.setItem('safvacut_auth_time', Date.now().toString());
            updateUIWithUserData(userProfile);
            loadAllContent();
          } else {
            console.log('No valid user data found, redirecting to login');
            window.location.href = 'login.html';
          }
        });
      } catch (error) {
        console.error('Error loading user profile:', error);
        window.location.href = 'login.html';
      }
    }

    // Update UI with user data - Mobile User ID prominently displayed
    function updateUIWithUserData(userData) {
      const userName = userData.displayName || userData.email.split('@')[0];
      const userEmail = userData.email;
      const userAvatar = userData.photoURL || `/placeholder.svg?height=40&width=40&query=${(userData.displayName || userData.email).charAt(0).toUpperCase()}`;
      const uniqueId = userData.uniqueId || 'Loading...';

      document.getElementById('user-name').textContent = userName;
      document.getElementById('user-email').textContent = userEmail;
      document.getElementById('header-user-name').textContent = userName;
      document.getElementById('user-avatar').src = userAvatar;
      document.getElementById('user-unique-id').textContent = uniqueId;

      // Mobile User ID Display - NEW LOCATION
      document.getElementById('mobile-user-unique-id').textContent = uniqueId;

      const settingsAvatar = document.getElementById('settings-avatar');
      const settingsUserId = document.getElementById('settings-user-id');
      if (settingsAvatar) settingsAvatar.src = userAvatar;
      if (settingsUserId) settingsUserId.textContent = uniqueId;

      const settingsNameInput = document.getElementById('settings-name');
      const settingsEmailInput = document.getElementById('settings-email');
      if (settingsNameInput) settingsNameInput.value = userData.displayName || '';
      if (settingsEmailInput) settingsEmailInput.value = userData.email || '';
    }

    // Copy mobile user ID function - NEW LOCATION
    window.copyMobileUserId = function () {
      const userId = document.getElementById('mobile-user-unique-id').textContent;
      navigator.clipboard.writeText(userId).then(() => {
        showToast('User ID copied to clipboard!', 'success');
      }).catch(() => {
        showToast('Failed to copy User ID', 'error');
      });
    };

    // Load all content
    function loadAllContent() {
      loadDashboardContent();
      loadPortfolioContent();
      loadTradingContent();
      loadTransactionsContent();
      loadStakingContent();
      loadSettingsContent();
    }

    // Load dashboard content - PRODUCTION READY (No demo data)
    function loadDashboardContent() {
      const assetsList = document.getElementById('assets-list');
      const transactionsList = document.getElementById('transactions-list');
      const marketOverview = document.getElementById('market-overview');

      if (assetsList) {
        assetsList.innerHTML = '';
        // Show user's actual assets with balances (only if they have balance > 0)
        const userAssets = cryptoAssets.filter(asset => userWalletData.balances[asset.symbol] > 0);

        if (userAssets.length === 0) {
          assetsList.innerHTML = `
          <div class="text-center py-8 text-gray-400">
            <i class="fas fa-wallet text-4xl mb-4"></i>
            <p>No assets yet. Start by receiving some cryptocurrency!</p>
            <button onclick="showReceiveModal()" class="btn-primary px-6 py-2 rounded-lg mt-4">
              <i class="fas fa-qrcode mr-2"></i>Get Started
            </button>
          </div>
        `;
        } else {
          userAssets.slice(0, 6).forEach((asset, index) => {
            const balance = userWalletData.balances[asset.symbol];
            const value = balance * asset.price;
            const changeClass = asset.change >= 0 ? 'price-up' : 'price-down';
            const changeIcon = asset.change >= 0 ? '↗' : '↘';

            assetsList.innerHTML += `
            <div class="crypto-item flex items-center justify-between p-4 modern-card crypto-card cursor-pointer"
                  data-aos="fade-up" data-aos-delay="${index * 100}"
                 onclick="openCryptoWallet('${asset.symbol}')">
              <div class="flex items-center space-x-3">
                <div class="crypto-icon w-10 h-10 rounded-full flex items-center justify-center ${asset.iconClass}">
                  <span class="text-white font-bold text-sm">${asset.symbol.charAt(0)}</span>
                </div>
                <div>
                  <div class="crypto-text font-medium">${asset.name}</div>
                  <div class="crypto-text text-sm text-gray-400">${balance.toFixed(8)} ${asset.symbol}</div>
                </div>
              </div>
              <div class="text-right">
                <div class="crypto-price font-medium">$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                <div class="text-sm ${changeClass}">${changeIcon} ${Math.abs(asset.change).toFixed(2)}%</div>
                <i class="fas fa-chevron-right text-gray-400 text-sm mt-1"></i>
              </div>
            </div>
          `;
          });
        }
      }

      if (transactionsList) {
        transactionsList.innerHTML = '';
        if (userWalletData.transactions.length === 0) {
          transactionsList.innerHTML = `
          <div class="text-center py-8 text-gray-400">
            <i class="fas fa-history text-4xl mb-4"></i>
            <p>No transactions yet. Your activity will appear here.</p>
          </div>
        `;
        } else {
          userWalletData.transactions.slice(0, 5).forEach((tx, index) => {
            const statusClass = `status-${tx.status}`;
            const typeIcon = getTransactionIcon(tx.type);
            const typeColor = getTransactionColor(tx.type);
            const timeAgo = getTimeAgo(tx.timestamp);

            transactionsList.innerHTML += `
            <div class="transaction-item flex items-center justify-between p-4 modern-card" data-aos="fade-up" data-aos-delay="${index * 100}">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full flex items-center justify-center ${typeColor}">
                  ${typeIcon}
                </div>
                <div>
                  <div class="font-medium capitalize">${tx.type} ${tx.asset}</div>
                  <div class="text-sm text-gray-400">${timeAgo}</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-medium">${tx.type === 'send' ? '-' : '+'}${tx.amount} ${tx.asset}</div>
                <div class="text-sm ${statusClass} px-2 py-1 rounded-full">${tx.status}</div>
              </div>
            </div>
          `;
          });
        }
      }

      if (marketOverview) {
        marketOverview.innerHTML = '';
        cryptoAssets.slice(0, 8).forEach((asset, index) => {
          const changeClass = asset.change >= 0 ? 'price-up' : 'price-down';
          const changeIcon = asset.change >= 0 ? '↗' : '↘';

          marketOverview.innerHTML += `
          <div class="modern-card p-4 crypto-card cursor-pointer"
                data-aos="fade-up" data-aos-delay="${index * 100}"
               onclick="openCryptoWallet('${asset.symbol}')">
            <div class="flex items-center space-x-3 mb-3">
              <div class="crypto-icon w-8 h-8 rounded-full flex items-center justify-center ${asset.iconClass}">
                <span class="text-white font-bold text-xs">${asset.symbol.charAt(0)}</span>
              </div>
              <div>
                <div class="font-medium">${asset.symbol}</div>
                <div class="text-xs text-gray-400">${asset.name}</div>
              </div>
            </div>
            <div class="text-lg font-bold mb-1">$${asset.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
            <div class="text-sm ${changeClass}">${changeIcon} ${Math.abs(asset.change).toFixed(2)}%</div>
          </div>
        `;
        });
      }

      // Update total balance
      const totalBalance = calculateTotalValue();
      document.getElementById('total-balance').textContent = totalBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

      // Update balance change display
      const balanceChangeElement = document.getElementById('balance-change');
      if (balanceChangeElement) {
        if (totalBalance === 0) {
          balanceChangeElement.textContent = '$0.00 (0.00%)';
          balanceChangeElement.className = 'text-sm font-medium price-neutral';
        } else {
          // Calculate actual 24h change based on portfolio
          const balanceChange = totalBalance * 0.0234; // Mock 2.34% change
          balanceChangeElement.textContent = `+$${balanceChange.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} (+2.34%)`;
          balanceChangeElement.className = 'text-sm font-medium price-up';
        }
      }
    }

    // Load portfolio content
    function loadPortfolioContent() {
      // Portfolio content implementation...
    }

    // Load trading content
    function loadTradingContent() {
      // Trading content implementation...
    }

    // Load transactions content - FULLY FUNCTIONAL WITH FIREBASE
    function loadTransactionsContent() {
      const transactionHistory = document.getElementById('transaction-history');
      const typeFilter = document.getElementById('transaction-type-filter');
      const assetFilter = document.getElementById('transaction-asset-filter');
      const dateFilter = document.getElementById('transaction-date-filter');
      const filterBtn = document.getElementById('filter-transactions-btn');

      function renderTransactions(transactions = userWalletData.transactions) {
        if (!transactionHistory) return;

        transactionHistory.innerHTML = '';

        if (transactions.length === 0) {
          transactionHistory.innerHTML = `
            <div class="text-center py-12 text-gray-400">
              <i class="fas fa-history text-5xl mb-4"></i>
              <h3 class="text-xl font-semibold mb-2">No Transactions Found</h3>
              <p class="text-gray-500">Your transaction history will appear here once you start trading.</p>
              <button onclick="showReceiveModal()" class="btn-primary px-6 py-3 rounded-lg mt-4">
                <i class="fas fa-qrcode mr-2"></i>Get Started
              </button>
            </div>
          `;
          return;
        }

        transactions.forEach((tx, index) => {
          const statusClass = `status-${tx.status}`;
          const typeIcon = getTransactionIcon(tx.type);
          const typeColor = getTransactionColor(tx.type);
          const timeAgo = getTimeAgo(tx.timestamp);
          const formattedDate = new Date(tx.timestamp).toLocaleDateString();
          const formattedTime = new Date(tx.timestamp).toLocaleTimeString();

          transactionHistory.innerHTML += `
            <div class="transaction-item flex items-center justify-between p-4 modern-card hover:bg-orange-500 hover:bg-opacity-5 transition-all cursor-pointer" 
                 data-aos="fade-up" data-aos-delay="${Math.min(index * 50, 500)}"
                 onclick="showTransactionDetails('${tx.id}')">
              <div class="flex items-center space-x-4">
                <div class="w-12 h-12 rounded-full flex items-center justify-center ${typeColor}">
                  ${typeIcon}
                </div>
                <div>
                  <div class="font-semibold capitalize text-lg">${tx.type} ${tx.asset}</div>
                  <div class="text-sm text-gray-400">${formattedDate} at ${formattedTime}</div>
                  <div class="text-xs text-gray-500 mt-1">Hash: ${tx.hash}</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-bold text-lg ${tx.type === 'send' ? 'text-red-400' : 'text-green-400'}">
                  ${tx.type === 'send' ? '-' : '+'}${tx.amount} ${tx.asset}
                </div>
                <div class="text-sm text-gray-400">$${tx.value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                <div class="text-sm ${statusClass} px-3 py-1 rounded-full mt-1 inline-block">${tx.status}</div>
              </div>
            </div>
          `;
        });
      }

      function filterTransactions() {
        const typeValue = typeFilter.value;
        const assetValue = assetFilter.value;
        const dateValue = dateFilter.value;

        let filteredTransactions = [...userWalletData.transactions];

        // Filter by type
        if (typeValue !== 'All Types') {
          filteredTransactions = filteredTransactions.filter(tx => tx.type === typeValue);
        }

        // Filter by asset
        if (assetValue !== 'All Assets') {
          filteredTransactions = filteredTransactions.filter(tx => tx.asset === assetValue);
        }

        // Filter by date
        if (dateValue) {
          const filterDate = new Date(dateValue);
          filteredTransactions = filteredTransactions.filter(tx => {
            const txDate = new Date(tx.timestamp);
            return txDate.toDateString() === filterDate.toDateString();
          });
        }

        renderTransactions(filteredTransactions);
      }

      // Set up filter event listeners
      if (filterBtn) {
        filterBtn.addEventListener('click', filterTransactions);
      }

      // Initial render
      renderTransactions();
    }

    // Show transaction details modal
    window.showTransactionDetails = function (transactionId) {
      const transaction = userWalletData.transactions.find(tx => tx.id === transactionId);
      if (!transaction) return;

      const statusColor = transaction.status === 'completed' ? 'text-green-500' :
        transaction.status === 'pending' ? 'text-yellow-500' : 'text-red-500';

      Swal.fire({
        title: `${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)} Transaction`,
        html: `
          <div class="text-left space-y-3">
            <div class="flex justify-between">
              <span class="text-gray-400">Asset:</span>
              <span class="font-semibold">${transaction.asset}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Amount:</span>
              <span class="font-semibold">${transaction.amount} ${transaction.asset}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Value:</span>
              <span class="font-semibold">$${transaction.value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Status:</span>
              <span class="font-semibold ${statusColor}">${transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1)}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Date:</span>
              <span class="font-semibold">${new Date(transaction.timestamp).toLocaleString()}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Hash:</span>
              <span class="font-mono text-sm">${transaction.hash}</span>
            </div>
          </div>
        `,
        confirmButtonColor: '#f7931a',
        background: 'rgba(15, 15, 35, 0.9)',
        color: '#ffffff'
      });
    };

    // Load staking content
    function loadStakingContent() {
      // Staking content implementation...
    }

    // Load settings content
    function loadSettingsContent() {
      // Settings content implementation...
    }

    // Helper functions for icons and colors
    function getTransactionIcon(type) {
      const icons = {
        send: '<i class="fas fa-paper-plane text-white text-sm"></i>',
        receive: '<i class="fas fa-arrow-down text-white text-sm"></i>',
        buy: '<i class="fas fa-credit-card text-white text-sm"></i>',
        sell: '<i class="fas fa-hand-holding-usd text-white text-sm"></i>',
        swap: '<i class="fas fa-exchange-alt text-white text-sm"></i>',
        stake: '<i class="fas fa-coins text-white text-sm"></i>'
      };
      return icons[type] || icons.send;
    }

    function getTransactionColor(type) {
      const colors = {
        send: 'bg-red-500 bg-opacity-20',
        receive: 'bg-green-500 bg-opacity-20',
        buy: 'bg-blue-500 bg-opacity-20',
        sell: 'bg-yellow-500 bg-opacity-20',
        swap: 'bg-purple-500 bg-opacity-20',
        stake: 'bg-orange-500 bg-opacity-20'
      };
      return colors[type] || colors.send;
    }

    // Get time ago string
    function getTimeAgo(timestamp) {
      const now = new Date();
      const time = new Date(timestamp);
      const diffInSeconds = Math.floor((now - time) / 1000);

      if (diffInSeconds < 60) return 'Just now';
      if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
      if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
      return `${Math.floor(diffInSeconds / 86400)} days ago`;
    }

    // Setup event listeners
    function setupEventListeners() {
      // Theme toggle
      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

      // Mobile menu toggle via header click
      document.getElementById('mobile-header-toggle').addEventListener('click', () => {
        if (window.innerWidth < 1024) {
          toggleMobileMenu();
        }
      });

      document.getElementById('mobile-overlay').addEventListener('click', closeMobileMenu);

      // Logout
      document.getElementById('logout-btn').addEventListener('click', handleLogout);

      // Modal triggers
      window.showSendModal = () => showModal('send-modal');
      window.showReceiveModal = () => showModal('receive-modal');
      window.showBuyModal = () => showModal('buy-modal');
      window.showSwapModal = () => showModal('swap-modal');

      // Setup copy user ID functionality
      setupCopyUserID();

      // Setup form handlers
      setupFormHandlers();
    }

    // Setup form handlers with ETH balance check
    function setupFormHandlers() {
      // Send form with ETH balance check
      document.getElementById('send-form').addEventListener('submit', handleSendTransaction);

      // Buy form - Show under construction message
      document.getElementById('buy-form').addEventListener('submit', handleBuyTransaction);

      // Swap form
      document.getElementById('swap-form').addEventListener('submit', handleSwapTransaction);

      // Update calculations on input changes
      document.getElementById('send-amount').addEventListener('input', updateSendCalculations);
      document.getElementById('buy-amount-usd').addEventListener('input', updateBuyCalculations);
      document.getElementById('swap-from-amount').addEventListener('input', updateSwapCalculations);

      // Asset selection changes
      document.getElementById('send-asset').addEventListener('change', updateSendAssetInfo);
      document.getElementById('buy-crypto').addEventListener('change', updateBuyCalculations);
      document.getElementById('swap-from-asset').addEventListener('change', updateSwapCalculations);
      document.getElementById('swap-to-asset').addEventListener('change', updateSwapCalculations);

      // Swap direction button
      document.getElementById('swap-direction-btn').addEventListener('click', swapAssetDirection);
    }

    // Handle send transaction with ETH balance check
    async function handleSendTransaction(e) {
      e.preventDefault();

      // Critical ETH Balance Check
      if (!checkEthBalance()) {
        return; // Stop transaction if ETH balance is insufficient
      }

      const asset = document.getElementById('send-asset').value;
      const address = document.getElementById('recipient-address').value;
      const amount = parseFloat(document.getElementById('send-amount').value);

      if (!asset || !address || !amount || amount <= 0) {
        showToast('Please fill in all fields correctly', 'error');
        return;
      }

      // Check if user has sufficient balance
      if (userWalletData.balances[asset] < amount) {
        showToast('Insufficient balance', 'error');
        return;
      }

      try {
        // Show confirmation
        const result = await Swal.fire({
          title: 'Confirm Transaction',
          html: `
          <div class="text-left">
            <p><strong>Asset:</strong> ${asset}</p>
            <p><strong>Amount:</strong> ${amount} ${asset}</p>
            <p><strong>To:</strong> ${address.substring(0, 20)}...</p>
          </div>
        `,
          icon: 'question',
          showCancelButton: true,
          confirmButtonColor: '#f7931a',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Send',
          cancelButtonText: 'Cancel',
          background: 'rgba(15, 15, 35, 0.9)',
          color: '#ffffff'
        });

        if (result.isConfirmed) {
          // Update balance
          userWalletData.balances[asset] -= amount;

          // Deduct ETH for network fees (without showing the amount)
          if (userWalletData.balances['ETH'] >= 0.001) {
            userWalletData.balances['ETH'] -= 0.001; // Deduct network fee from ETH
          }

          // Add transaction
          const assetPrice = cryptoAssets.find(a => a.symbol === asset)?.price || 0;
          addTransaction('send', asset, amount, amount * assetPrice);

          // Update UI
          loadAllContent();

          // Close modal
          document.getElementById('send-modal').classList.remove('active');
          showToast('Transaction sent successfully!', 'success');
        }
      } catch (error) {
        console.error('Send transaction error:', error);
        showToast('Transaction failed. Please try again.', 'error');
      }
    }

    // Handle buy transaction - Show under construction
    async function handleBuyTransaction(e) {
      e.preventDefault();

      // Show under construction message
      Swal.fire({
        title: 'Feature Under Construction',
        text: 'Please be patient, this feature is still under construction and will be available soon.',
        icon: 'info',
        confirmButtonColor: '#f7931a',
        background: 'rgba(15, 15, 35, 0.9)',
        color: '#ffffff'
      });
    }

    // Handle swap transaction
    async function handleSwapTransaction(e) {
      e.preventDefault();

      const fromAsset = document.getElementById('swap-from-asset').value;
      const toAsset = document.getElementById('swap-to-asset').value;
      const fromAmount = parseFloat(document.getElementById('swap-from-amount').value);
      const toAmount = parseFloat(document.getElementById('swap-to-amount').value);

      if (!fromAsset || !toAsset || !fromAmount || fromAmount <= 0) {
        showToast('Please fill in all fields correctly', 'error');
        return;
      }

      if (fromAsset === toAsset) {
        showToast('Cannot swap the same asset', 'error');
        return;
      }

      // Check if user has sufficient balance
      if (userWalletData.balances[fromAsset] < fromAmount) {
        showToast('Insufficient balance', 'error');
        return;
      }

      try {
        // Show confirmation
        const result = await Swal.fire({
          title: 'Confirm Swap',
          html: `
          <div class="text-left">
            <p><strong>From:</strong> ${fromAmount} ${fromAsset}</p>
            <p><strong>To:</strong> ${toAmount.toFixed(8)} ${toAsset}</p>
            <p><strong>Rate:</strong> 1 ${fromAsset} = ${(toAmount / fromAmount).toFixed(8)} ${toAsset}</p>
          </div>
        `,
          icon: 'question',
          showCancelButton: true,
          confirmButtonColor: '#f7931a',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Swap',
          cancelButtonText: 'Cancel',
          background: 'rgba(15, 15, 35, 0.9)',
          color: '#ffffff'
        });

        if (result.isConfirmed) {
          // Update balances
          userWalletData.balances[fromAsset] -= fromAmount;
          if (!userWalletData.balances[toAsset]) {
            userWalletData.balances[toAsset] = 0;
          }
          userWalletData.balances[toAsset] += toAmount;

          // Add transaction
          const fromAssetPrice = cryptoAssets.find(a => a.symbol === fromAsset)?.price || 0;
          addTransaction('swap', `${fromAsset}→${toAsset}`, fromAmount, fromAmount * fromAssetPrice);

          // Update UI
          loadAllContent();

          // Close modal
          document.getElementById('swap-modal').classList.remove('active');
          showToast('Swap completed successfully!', 'success');
        }
      } catch (error) {
        console.error('Swap transaction error:', error);
        showToast('Swap failed. Please try again.', 'error');
      }
    }

    // Update calculations
    function updateSendCalculations() {
      const asset = document.getElementById('send-asset').value;
      const amount = parseFloat(document.getElementById('send-amount').value) || 0;
      const assetData = cryptoAssets.find(a => a.symbol === asset);

      if (assetData) {
        const value = amount * assetData.price;
        document.getElementById('send-total').textContent = `$${value.toFixed(2)}`;
      }
    }

    function updateBuyCalculations() {
      const asset = document.getElementById('buy-crypto').value;
      const usdAmount = parseFloat(document.getElementById('buy-amount-usd').value) || 0;
      const assetData = cryptoAssets.find(a => a.symbol === asset);

      if (assetData && usdAmount > 0) {
        const fee = usdAmount * 0.025; // 2.5% fee
        const cryptoAmount = usdAmount / assetData.price;
        document.getElementById('buy-processing-fee').textContent = `$${fee.toFixed(2)}`;
        document.getElementById('buy-crypto-amount').textContent = `${cryptoAmount.toFixed(8)} ${asset}`;
      }
    }

    function updateSwapCalculations() {
      const fromAsset = document.getElementById('swap-from-asset').value;
      const toAsset = document.getElementById('swap-to-asset').value;
      const fromAmount = parseFloat(document.getElementById('swap-from-amount').value) || 0;

      const fromAssetData = cryptoAssets.find(a => a.symbol === fromAsset);
      const toAssetData = cryptoAssets.find(a => a.symbol === toAsset);

      if (fromAssetData && toAssetData && fromAmount > 0) {
        const fromValue = fromAmount * fromAssetData.price;
        const toAmount = fromValue / toAssetData.price;
        const rate = toAmount / fromAmount;

        document.getElementById('swap-to-amount').value = toAmount.toFixed(8);
        document.getElementById('swap-rate').textContent = `1 ${fromAsset} = ${rate.toFixed(8)} ${toAsset}`;
        document.getElementById('swap-network-fee').textContent = '~$2.50';
        document.getElementById('swap-minimum').textContent = `${(toAmount * 0.995).toFixed(8)} ${toAsset}`;

        // Update available balance
        const availableBalance = userWalletData.balances[fromAsset] || 0;
        document.getElementById('swap-available-balance').textContent = `${availableBalance.toFixed(8)} ${fromAsset}`;
      }
    }

    function updateSendAssetInfo() {
      const asset = document.getElementById('send-asset').value;
      const availableBalance = userWalletData.balances[asset] || 0;
      document.getElementById('send-available-balance').textContent = `${availableBalance.toFixed(8)} ${asset}`;
    }

    function swapAssetDirection() {
      const fromAsset = document.getElementById('swap-from-asset');
      const toAsset = document.getElementById('swap-to-asset');
      const tempValue = fromAsset.value;
      fromAsset.value = toAsset.value;
      toAsset.value = tempValue;

      // Clear amounts
      document.getElementById('swap-from-amount').value = '';
      document.getElementById('swap-to-amount').value = '';
      updateSwapCalculations();
    }

    // Setup navigation
    function setupNavigation() {
      const navItems = document.querySelectorAll('.nav-item[data-section]');
      const sections = document.querySelectorAll('.section-content');

      navItems.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const targetSection = item.getAttribute('data-section');

          // Update active nav item
          navItems.forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');

          // Show target section
          sections.forEach(section => section.classList.add('hidden'));
          document.getElementById(`${targetSection}-section`).classList.remove('hidden');

          // Close mobile menu if open
          closeMobileMenu();

          // Refresh AOS animations for the new section
          AOS.refresh();
        });
      });

      // Set initial active section based on URL hash or default to dashboard
      const initialSection = window.location.hash.substring(1) || 'dashboard';
      const initialNavItem = document.querySelector(`.nav-item[data-section="${initialSection}"]`);
      if (initialNavItem) {
        initialNavItem.click();
      } else {
        document.querySelector('.nav-item[data-section="dashboard"]').click();
      }
    }

    // Setup modals
    function setupModals() {
      const modals = document.querySelectorAll('.modal');
      const closeButtons = document.querySelectorAll('.close-modal');

      closeButtons.forEach(button => {
        button.addEventListener('click', () => {
          const modal = button.closest('.modal');
          modal.classList.remove('active');
        });
      });

      modals.forEach(modal => {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.remove('active');
          }
        });
      });

      // Setup receive modal specific logic with real QR codes
      setupReceiveModal();
    }

    // Setup receive modal with real QR codes
    function setupReceiveModal() {
      const receiveAsset = document.getElementById('receive-asset');
      const receiveAddress = document.getElementById('receive-address');
      const receiveQRImage = document.getElementById('receive-qr-image');
      const receiveAssetName = document.getElementById('receive-asset-name');
      const copyAddressBtn = document.getElementById('copy-address');
      const shareAddressBtn = document.getElementById('share-address');

      function updateReceiveAddress() {
        const selectedAsset = receiveAsset.value;
        const walletData = walletAddresses[selectedAsset];
        const assetData = cryptoAssets.find(a => a.symbol.toLowerCase() === selectedAsset);

        if (walletData) {
          receiveAddress.textContent = walletData.address;
          receiveQRImage.src = walletData.qrImage;
          receiveQRImage.alt = `${selectedAsset.toUpperCase()} QR Code`;
        }

        receiveAssetName.textContent = assetData ? assetData.name : selectedAsset.toUpperCase();
      }

      receiveAsset.addEventListener('change', updateReceiveAddress);

      copyAddressBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(receiveAddress.textContent).then(() => {
          showToast('Address copied to clipboard!', 'success');
          // Visual feedback
          const originalText = copyAddressBtn.innerHTML;
          copyAddressBtn.innerHTML = '<i class="fas fa-check w-5 h-5 mr-2"></i>Copied!';
          copyAddressBtn.classList.add('bg-green-500');
          setTimeout(() => {
            copyAddressBtn.innerHTML = originalText;
            copyAddressBtn.classList.remove('bg-green-500');
          }, 2000);
        });
      });

      shareAddressBtn.addEventListener('click', () => {
        if (navigator.share) {
          navigator.share({
            title: 'Safvacut Wallet Address',
            text: receiveAddress.textContent
          });
        } else {
          navigator.clipboard.writeText(receiveAddress.textContent).then(() => {
            showToast('Address copied for sharing!', 'info');
          });
        }
      });

      // Initialize with default address
      updateReceiveAddress();
    }

    // Initialize chart
    function initializeChart() {
      const ctx = document.getElementById('portfolio-chart');
      if (ctx) {
        if (portfolioChartInstance) {
          portfolioChartInstance.destroy();
        }

        // Generate chart data based on user's portfolio
        const totalValue = calculateTotalValue();
        const chartData = totalValue > 0 ?
          [totalValue * 0.8, totalValue * 0.85, totalValue * 0.9, totalValue * 0.95, totalValue, totalValue * 1.02] :
          [0, 0, 0, 0, 0, 0];

        portfolioChartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
              label: 'Portfolio Value',
              data: chartData,
              borderColor: '#f7931e',
              backgroundColor: 'rgba(247, 147, 30, 0.1)',
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointBackgroundColor: '#f7931e',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              x: {
                display: false
              },
              y: {
                display: false
              }
            },
            elements: {
              point: {
                radius: 0,
                hoverRadius: 6
              }
            },
            interaction: {
              intersect: false,
              mode: 'index'
            }
          }
        });
      }
    }

    // Profile image upload functionality
    window.triggerImageUpload = function () {
      document.getElementById('profile-image-input').click();
    };

    // Handle profile image upload with enhanced error handling
    document.getElementById('profile-image-input').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      // Validate file type
      if (!file.type.startsWith('image/')) {
        showToast('Please select a valid image file', 'error');
        return;
      }

      // Validate file size (5MB limit)
      if (file.size > 5 * 1024 * 1024) {
        showToast('Image size should be less than 5MB', 'error');
        return;
      }

      try {
        // Show loading with progress
        Swal.fire({
          title: 'Uploading Image...',
          html: `
          <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p>Please wait while we upload your profile image.</p>
            <div class="text-sm text-gray-400 mt-2">This may take a few moments...</div>
          </div>
        `,
          allowOutsideClick: false,
          showConfirmButton: false,
          background: 'rgba(15, 15, 35, 0.9)',
          color: '#ffffff'
        });

        // Create unique filename with timestamp
        const timestamp = Date.now();
        const fileName = `${timestamp}_${file.name.replace(/[^a-zA-Z0-9.]/g, '_')}`;

        // Upload to Firebase Storage with proper path
        const storageRef = ref(storage, `profile-images/${currentUser.uid}/${fileName}`);

        // Upload file
        const snapshot = await uploadBytes(storageRef, file);
        console.log('Upload successful:', snapshot);

        // Get download URL
        const downloadURL = await getDownloadURL(snapshot.ref);
        console.log('Download URL:', downloadURL);

        // Update user profile in Firebase Auth
        await firebaseUpdateProfile(currentUser, {
          photoURL: downloadURL
        });

        // Update user profile in Firestore
        const userDocRef = doc(db, "users", currentUser.uid);
        await updateDoc(userDocRef, {
          photoURL: downloadURL,
          updatedAt: serverTimestamp()
        });

        // Update local storage and UI
        userProfile.photoURL = downloadURL;
        localStorage.setItem('safvacut_user', JSON.stringify(userProfile));

        // Update all avatar images
        document.getElementById('user-avatar').src = downloadURL;
        const settingsAvatar = document.getElementById('settings-avatar');
        if (settingsAvatar) settingsAvatar.src = downloadURL;

        Swal.close();
        showToast('Profile image updated successfully!', 'success');
      } catch (error) {
        console.error('Error uploading image:', error);
        Swal.close();

        // Provide specific error messages
        let errorMessage = 'Failed to upload image. Please try again.';
        if (error.code === 'storage/unauthorized') {
          errorMessage = 'Upload failed: Please check your permissions and try again.';
        } else if (error.code === 'storage/canceled') {
          errorMessage = 'Upload was canceled. Please try again.';
        } else if (error.code === 'storage/unknown') {
          errorMessage = 'An unknown error occurred. Please check your internet connection.';
        }

        showToast(errorMessage, 'error');
      }
    });

    // Copy user ID functionality
    function setupCopyUserID() {
      document.getElementById('copy-user-id').addEventListener('click', () => {
        const userId = document.getElementById('user-unique-id').textContent;
        navigator.clipboard.writeText(userId).then(() => {
          showToast('User ID copied to clipboard!', 'success');
          // Visual feedback
          const copyBtn = document.getElementById('copy-user-id');
          const originalIcon = copyBtn.innerHTML;
          copyBtn.innerHTML = '<i class="fas fa-check text-green-500 text-sm"></i>';
          setTimeout(() => {
            copyBtn.innerHTML = originalIcon;
          }, 2000);
        }).catch(() => {
          showToast('Failed to copy User ID', 'error');
        });
      });

      // Mobile User ID copy functionality - NEW
      const copyMobileBtn = document.getElementById('copy-mobile-user-id');
      if (copyMobileBtn) {
        copyMobileBtn.addEventListener('click', () => {
          const userId = document.getElementById('mobile-user-unique-id').textContent;
          navigator.clipboard.writeText(userId).then(() => {
            showToast('User ID copied to clipboard!', 'success');
            // Visual feedback
            const originalIcon = copyMobileBtn.innerHTML;
            copyMobileBtn.innerHTML = '<i class="fas fa-check text-green-500 text-lg"></i>';
            setTimeout(() => {
              copyMobileBtn.innerHTML = originalIcon;
            }, 2000);
          }).catch(() => {
            showToast('Failed to copy User ID', 'error');
          });
        });
      }

      const copySettingsBtn = document.getElementById('copy-settings-user-id');
      if (copySettingsBtn) {
        copySettingsBtn.addEventListener('click', () => {
          const userId = document.getElementById('settings-user-id').textContent;
          navigator.clipboard.writeText(userId).then(() => {
            showToast('User ID copied to clipboard!', 'success');
            // Visual feedback
            const originalIcon = copySettingsBtn.innerHTML;
            copySettingsBtn.innerHTML = '<i class="fas fa-check text-green-500"></i>';
            setTimeout(() => {
              copySettingsBtn.innerHTML = originalIcon;
            }, 2000);
          }).catch(() => {
            showToast('Failed to copy User ID', 'error');
          });
        });
      }
    }

    // Utility functions
    function showModal(modalId) {
      document.getElementById(modalId).classList.add('active');
      // Update modal data when opened
      if (modalId === 'send-modal') {
        updateSendAssetInfo();
      } else if (modalId === 'swap-modal') {
        updateSwapCalculations();
      }
    }

    function toggleTheme() {
      const body = document.body;
      const themeIconDark = document.getElementById('theme-icon-dark');
      const themeIconLight = document.getElementById('theme-icon-light');

      if (body.classList.contains('dark')) {
        body.classList.remove('dark', 'dark-theme');
        body.classList.add('light', 'light-theme');
        themeIconDark.classList.remove('hidden');
        themeIconLight.classList.add('hidden');
        localStorage.setItem('theme', 'light');
      } else {
        body.classList.remove('light', 'light-theme');
        body.classList.add('dark', 'dark-theme');
        themeIconDark.classList.add('hidden');
        themeIconLight.classList.remove('hidden');
      }
    }

    function toggleMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('mobile-overlay');
      sidebar.classList.toggle('sidebar-collapsed');
      overlay.classList.toggle('active');
    }

    function closeMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('mobile-overlay');
      sidebar.classList.add('sidebar-collapsed');
      overlay.classList.remove('active');
    }

    function showToast(message, type = 'success') {
      Swal.fire({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        icon: type,
        title: message,
        background: 'rgba(15, 15, 35, 0.9)',
        color: '#ffffff',
        iconColor: type === 'success' ? '#10b981' : (type === 'error' ? '#ef4444' : '#f59e0b')
      });
    }

    async function handleLogout() {
      try {
        const result = await Swal.fire({
          title: 'Sign Out',
          text: 'Are you sure you want to sign out?',
          icon: 'question',
          showCancelButton: true,
          confirmButtonColor: '#f7931a',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Yes, sign out',
          cancelButtonText: 'Cancel',
          background: 'rgba(15, 15, 35, 0.9)',
          color: '#ffffff'
        });

        if (result.isConfirmed) {
          await signOut(auth);
          localStorage.removeItem('safvacut_user');
          localStorage.removeItem('safvacut_auth_time');
          showToast('Successfully signed out', 'success');
          setTimeout(() => {
            window.location.href = 'login.html';
          }, 1000);
        }
      } catch (error) {
        console.error('Logout error:', error);
        showToast('Error signing out', 'error');
      }
    }

    // Check authentication state on page load
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        localStorage.removeItem('safvacut_user');
        localStorage.removeItem('safvacut_auth_time');
        if (window.location.pathname !== '/login.html') {
          window.location.href = 'login.html';
        }
      } else {
        const sidebar = document.getElementById('sidebar');
        if (sidebar && window.innerWidth >= 1024) {
          sidebar.classList.remove('sidebar-collapsed');
        }
      }
    });

    // Initialize dashboard when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      initializeDashboard();

      // Load saved theme
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.remove('dark', 'dark-theme');
        document.body.classList.add('light', 'light-theme');
        document.getElementById('theme-icon-dark').classList.remove('hidden');
        document.getElementById('theme-icon-light').classList.add('hidden');
      } else {
        document.body.classList.remove('light', 'light-theme');
        document.body.classList.add('dark', 'dark-theme');
        document.getElementById('theme-icon-dark').classList.add('hidden');
        document.getElementById('theme-icon-light').classList.remove('hidden');
      }

      // Handle window resize
      window.addEventListener('resize', () => {
        const sidebar = document.getElementById('sidebar');
        if (window.innerWidth >= 1024) {
          sidebar.classList.remove('sidebar-collapsed');
          document.getElementById('mobile-overlay').classList.remove('active');
        } else {
          sidebar.classList.add('sidebar-collapsed');
        }
      });
    });
  </script>
</body>

</html>
